/*WCD Lazy Load*/

if( window["wcd"] === undefined ) { var wcd = { }; }

if( location.pathname != "/checkout/order.do" && typeof wcd !== "undefined" ) {
wcd.ContentLazyLoader={debugMode:!1,$window:[],loadMode:"normal",isTouchDevice:!1,didScroll:!1,scrollIntervalListen:0,containerSelectorNormal:".wcdContentLazyLoad",contentToLLNormal:[],contentToLLAll:[],categoryPageLLEventName:"wcdCategoryMarketing:initialPageRenderComplete",currentScrollBottomPosition:0,currentContentItor:0,totalContentToLL:0,loadOffsetStaticContent:250,loadOffsetJSFunction:400,llMaskSize:700,lastPos:0,newPos:0,deltaPos:0,rateOfScrollRatio:1,regularRateOfScroll:50,currentRateOfScroll:50,initialLoadLLCheckTimeout:0,postInitialLoadLLCheckTimeout:0,scrollIntervalListener:250,containersToLL:[],loadOffsetContainer:300,currentContainerItor:0,hpDpLoadedFlags:[],totalContainersToLL:0,maskFadeTime:1,init:function(){var t=wcd.ContentLazyLoader;location.search.indexOf("llDebug=true")>-1&&(t.debugMode=!0,t.debugOutput("lazy loading in debug mode")),t.$window=jQuery(window),t.isTouchDevice=t.isTouchDeviceCheck(),t.contentToLLNormal=jQuery(t.containerSelectorNormal),t.containersToLL=jQuery(".mkt_reg-hp div[class*='mkt_reg-hp--'], .mkt_reg-dp div[class*='mkt_reg-dp--']"),(t.contentToLLNormal.length>0||t.containersToLL.length>0)&&("/browse/category.do"==location.pathname?jQuery(document).on(t.categoryPageLLEventName,function(e){t.debugMode&&t.debugOutput("category page normal lazy load launched"),t.llReadyHandler()}):jQuery(document).ready(function(e){t.debugMode&&t.debugOutput("normal lazy load launched"),t.llReadyHandler()}))},llReadyHandler:function(){var t=wcd.ContentLazyLoader;t.debugMode&&t.debugOutput("lazy load ready called"),t.contentToLLAll=jQuery(t.containerSelectorNormal+" picture:has(img[data-src]), "+t.containerSelectorNormal+" video:has(source[data-src]), "+t.containerSelectorNormal+" iframe[data-src], "+t.containerSelectorNormal+" div[data-background-image], "+t.containerSelectorNormal+" div[data-lazycallback], "+t.containerSelectorNormal+" div[data-lazyclass], "+t.containerSelectorNormal+" div[data-lazycodeblock]"),t.debugMode&&t.debugOutput("contentToLLAll","1",t.contentToLLAll),t.totalContentToLL=t.contentToLLAll.length,t.totalContainersToLL=t.containersToLL.length,t.totalContentToLL>0&&(t.sortContentByTopOffset(),t.applyMask()),(t.totalContentToLL>0||t.totalContainersToLL>0)&&(t.llToCurrentScrollBottom(),t.addScrollIntervalListeners())},sortContentByTopOffset:function(){var t=wcd.ContentLazyLoader;t.debugMode&&t.debugOutput("sorting content array");var e=[],o=[],a={},r=0,d=0;jQuery(t.contentToLLAll).each(function(t,n){(o=jQuery(n)).length>0&&o.offset()&&void 0!==(a=o.offset()).top&&void 0!==a.left&&(r=a.top,d=a.left,e.push({top:r,left:d,obj:o[0]}))}),t.debugMode&&t.debugOutput("presort arr","1",e),e.sort(function(t,e){return t.top==e.top?t.left-e.left:t.top-e.top}),t.debugMode&&t.debugOutput("sorted sorting arr","1",e);for(var n=[],l=0;l<e.length;l++)t.debugMode&&void 0!==e[l].top&&void 0!==e[l].left&&void 0!==e[l].obj&&void 0!==e[l].obj.tagName&&t.debugOutput(e[l].top+", "+e[l].left+" - "+e[l].obj.tagName),n.push(e[l].obj);t.contentToLLAll=n,t.debugMode&&t.debugOutput("final content arr","1",t.contentToLLAll)},applyMask:function(){var t=wcd.ContentLazyLoader;t.debugMode&&t.debugOutput("lazy load check called");var e=[];jQuery(t.contentToLLAll).each(function(o,a){"PICTURE"==(e=jQuery(a)).prop("tagName")&&e.css({height:t.llMaskSize.toString()+"px","vertical-align":"top","-webkit-opacity":"0","-moz-opacity":"0",opacity:"0","-webkit-transition":"all "+t.maskFadeTime+"s ease","-moz-transition":"all "+t.maskFadeTime+"s ease","-ms-transition":"all "+t.maskFadeTime+"s ease","-o-transition":"all "+t.maskFadeTime+"s ease",transition:"all "+t.maskFadeTime+"s ease"}),e.is("div[data-lazycodeblock]")?e.css({height:t.llMaskSize.toString()+"px","vertical-align":"top","-webkit-opacity":"0","-moz-opacity":"0",opacity:"0","-webkit-transition":"all "+t.maskFadeTime+"s ease","-moz-transition":"all "+t.maskFadeTime+"s ease","-ms-transition":"all "+t.maskFadeTime+"s ease","-o-transition":"all "+t.maskFadeTime+"s ease",transition:"all "+t.maskFadeTime+"s ease"}):e.css({"vertical-align":"top"})}),t.debugMode&&t.debugOutput("with false css added","1",t.contentToLLAll)},llToCurrentScrollBottom:function(){var t=wcd.ContentLazyLoader;if(t.debugMode&&t.debugOutput("ll to current scroll bottom called"),!t.isLazyLoading){t.isLazyLoading=!0;var e=t.initialLoadLLCheckTimeout,o=t.$window.scrollTop()+t.$window.height(),a=!1,r=jQuery(t.containersToLL[t.currentContainerItor]);if(r.length>0){if(void 0!==r.offset()&&o+t.loadOffsetContainer>=r.offset().top){var d=r.attr("class");void 0===t.hpDpLoadedFlags[d]&&(jQuery(document).trigger("container--"+d+":loaded"),t.debugMode&&t.debugOutput("container--"+d+":loaded event fired","2")),t.hpDpLoadedFlags[d]=!0,t.currentContainerItor++,a=!0,t.debugMode&&t.debugOutput("container "+t.currentContainerItor+" loaded - "+d,"2")}}else t.debugMode&&t.debugOutput("current container "+t.currentContainerItor+" not found","2");var n=jQuery(t.contentToLLAll[t.currentContentItor]);t.debugMode&&t.debugOutput("checking content "+t.currentContentItor+" at timeout "+e,"1",n),n.length>0?void 0!==n.offset()&&(n.is("div[data-lazycallback],div[data-lazycodeblock]")?(o+=t.loadOffsetJSFunction*t.rateOfScrollRatio,t.debugMode&&t.debugOutput("content bottom = "+o+" (includes offset of "+t.loadOffsetJSFunction+" * ratio "+t.rateOfScrollRatio+")")):(o+=t.loadOffsetStaticContent*t.rateOfScrollRatio,t.debugMode&&t.debugOutput("content bottom = "+o+" (includes offset of "+t.loadOffsetStaticContent+" * ratio "+t.rateOfScrollRatio+")")),t.debugMode&&t.debugOutput("measuring current bottom (+offset): "+o+" to top of content: "+n.offset().top),o>=n.offset().top?(t.lazyLoadElement(n),t.currentContentItor++,a=!0):t.initialLoadLLCheckTimeout=t.postInitialLoadLLCheckTimeout):t.debugMode&&t.debugOutput("current content "+t.currentContentItor+" not found"),t.currentContentItor>=t.totalContentToLL&&t.currentContainerItor>=t.totalContainersToLL?(t.removeScrollIntervalListeners(),t.debugMode&&(t.debugOutput("all content and containers loaded"),t.debugOutput("end"))):a&&setTimeout(function(){t.llToCurrentScrollBottom()},e),t.isLazyLoading=!1}},lazyLoadElement:function(t){var e=wcd.ContentLazyLoader;if(e.debugMode&&e.debugOutput("lazy loading individual element","1",t),t.is("picture")){var o=t.find("source[data-srcset]");o.length>0&&o.attr("srcset",function(t,o){return e.debugMode&&e.debugOutput("lled picture source - "+jQuery(this).attr("data-srcset")),jQuery(this).attr("data-srcset")}).removeAttr("data-srcset");var a=t.find("img[data-src]");a.length>0&&a.load(function(o,a){t.css({height:"auto","-webkit-opacity":"1","-moz-opacity":"1",opacity:"1"}),e.debugMode&&e.debugOutput("/////////// IMAGE LOADED, MASK REMOVED ////////////")}).attr("src",function(t,o){return e.debugMode&&e.debugOutput("lled picture img - "+jQuery(this).attr("data-src")),jQuery(this).attr("data-src")}).removeAttr("data-src")}else if(t.is("video")){var r=t.find("source[data-srcset]");r.length>0&&r.attr("src",function(t,o){return e.debugMode&&e.debugOutput("lled video source - "+jQuery(this).attr("data-src")),jQuery(this).attr("data-src")}).removeAttr("data-src")}else if(t.is("iframe[data-src]"))t.attr("src",t.attr("data-src")).removeAttr("data-src"),e.debugMode&&e.debugOutput("lled iframe - "+t.attr("src"));else if(t.is("div[data-background-image]")){console.log("what the heck",t,t.attr("data-background-image"));var d=t.attr("data-background-image");t.css("background-image","url("+d+")").removeAttr("data-background-image"),e.debugMode&&e.debugOutput("lled background image - "+t.css("background"))}else if(t.is("div[data-lazycallback]")){var n=t.attr("data-lazycallback");void 0!==window[n]&&"function"==typeof window[n]&&(0,window[n])(),e.debugMode&&e.debugOutput("lled JS function - "+t.attr("data-lazycallback"))}else if(t.is("div[data-lazyclass]")){var l=t.attr("data-lazyclass");t.addClass(l).removeAttr("data-lazyclass"),e.debugMode&&e.debugOutput("lled classname - "+l)}else if(t.is("div[data-lazycodeblock]")){var c=t.attr("data-lazycodeblock"),i=t.attr("data-lazycodeblockid");jQuery.ajax({type:"GET",url:c,dataType:"html",cache:!0,success:function(o){t.html(o),void 0!==i&&jQuery(document).trigger(i+":loaded"),t.css({height:"auto","-webkit-opacity":"1","-moz-opacity":"1",opacity:"1"}),e.debugMode&&e.debugOutput("lled code block - "+c+" for ID "+i)}})}},selectiveLoadElements:function(t){var e=wcd.ContentLazyLoader;e.debugMode&&e.debugOutput("lazy loading individual element","1",content);var o=jQuery(t+" source[data-slsrcset], "+t+" img[data-slsrc], "+t+" div[data-slcallback], "+t+" div[data-slclass], "+t+" div[data-slcodeblock]");o.length>0&&jQuery(o).each(function(t,o){var a=jQuery(o);if(a.is("source"))a.attr("srcset",function(t,o){return e.debugMode&&e.debugOutput("sled picture source - "+jQuery(this).attr("data-slsrcset")),jQuery(this).attr("data-slsrcset")}).removeAttr("data-slsrcset");else if(a.is("img"))a.attr("src",function(t,o){return e.debugMode&&e.debugOutput("sled picture img - "+jQuery(this).attr("data-slsrc")),jQuery(this).attr("data-slsrc")}).removeAttr("data-slsrc");else if(a.is("div[data-slcallback]")){var r=a.attr("data-slcallback");void 0!==window[r]&&"function"==typeof window[r]&&(0,window[r])(),e.debugMode&&e.debugOutput("lled JS function - "+a.attr("data-slcallback"))}else if(a.is("div[data-slclass]")){var d=a.attr("data-slclass");a.addClass(d).removeAttr("data-slclass"),e.debugMode&&e.debugOutput("lled classname - "+d)}else if(a.is("div[data-slcodeblock]")){var n=a.attr("data-slcodeblock"),l=a.attr("data-slcodeblockid");jQuery.ajax({type:"GET",url:n,dataType:"html",cache:!0,success:function(t){a.html(t),void 0!==l&&jQuery(document).trigger(l+":loaded"),e.debugMode&&e.debugOutput("lled code block - "+n+" for ID "+l)}})}})},addScrollIntervalListeners:function(){var t=wcd.ContentLazyLoader;t.debugMode&&t.debugOutput("add scroll handlers called"),jQuery(window).on("scroll",t.setScrolled),t.isTouchDevice&&jQuery("body").on("touchmove",t.setScrolled),t.scrollIntervalListen=setInterval(function(){t.didScroll&&(t.didScroll=!1,t.debugMode&&t.debugOutput("scroll detected @ "+t.scrollIntervalListener+"ms interval"),t.llToCurrentScrollBottom())},t.scrollIntervalListener)},removeScrollIntervalListeners:function(){var t=wcd.ContentLazyLoader;t.debugMode&&t.debugOutput("remvoe scroll handlers called, scroll interval cleared"),jQuery(window).off("scroll",t.setScrolled),t.isTouchDevice&&jQuery("body").off("touchmove",t.setScrolled),clearInterval(t.scrollIntervalListen)},setScrolled:function(){wcd.ContentLazyLoader.didScroll=!0},isTouchDeviceCheck:function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}},debugOutput:function(t,e,o){if(void 0!==window.console&&console.log&&void 0!==window.performance&&performance.now&&performance.mark){var a="color:green; text-transform:uppercase; font-size:14px";void 0!==e&&"2"==e&&(a="color:red; text-transform:uppercase; font-size:14px"),console.log("%c"+t+" %c@ time "+performance.now().toFixed(4),a,"color:black"),void 0!==o&&console.log(o)}}},wcd.ContentLazyLoader.init();
}
